/*
*   eSlider jQuery Plugin
*   V0.9.2
*   ethagnawl@gmail.com
*   https://github.com/ethagnawl/eSlider
*   Copyright 2011, Pete Doherty
*   Date: Mon Feb 14 12:42:00 EST 2011
*
*   eSlider is distributed under the terms of the GNU General Public License.
*
*   This program is free software: you can redistribute it and/or modify
*   it under the terms of the GNU General Public License as published by
*   the Free Software Foundation, either version 3 of the License, or
*   (at your option) any later version.
*
*   This program is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
*   GNU General Public License for more details.
*
*   http://www.gnu.org/licenses/gpl.txt
*
*/

(function(h){h.fn.eSlider=function(p){var a={auto_slide:5E3,fade_speed:"slow",key_nav:false,left_arrow:"<",last:"last",loading:"loading",per_page:7,reset:true,right_arrow:">",size:"m",slide_speed:"slow"},m=function(f,g,j,d,l,i){$e=document.createElement(f);if(g)$e.id=g;if(j)for(var k in j)j.hasOwnProperty(k)&&$e.setAttribute([k],j[k]);if(d)typeof d==="object"?$e.className=d.join(" "):$e.className=d;l&&$e.appendChild(document.createTextNode(l));if(i)if(i.length)for(g=0;g<i.length;g++)$e.appendChild(i[g]);
else $e.appendChild(i);return $e},s=function(){b.count+=1;if(b.count===b.pages)b.fin=true;var f="ul_"+b.count,g=m("ul",f,0,"on"),j=0,d;for(d=0;d<a.per_page;d+=1)g.appendChild(m("li",f+"_li_"+d,0,d+1===a.per_page?[a.loading,a.last]:a.loading));h.getJSON("http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key="+a.api_key+"&photoset_id="+a.set_id+"&per_page="+a.per_page+"&page="+b.count+"&format=json&jsoncallback=?",function(l){var i=l.photoset.photo;if(i.length<a.per_page)b.fin=
true;b.pages=l.photoset.pages;h.each(i,function(k,n){var q=f+"_li_"+k,r=f+"_img_"+k,o=new Image;o.id=r;o.alt=n.title;o.onload=function(){h(document.getElementById(q)).removeClass(a.loading);h(document.getElementById(r)).fadeIn(a.fade_speed)};o.src="http://farm"+n.farm+".static.flickr.com/"+n.server+"/"+n.id+"_"+n.secret+"_"+a.size+".jpg";document.getElementById(q).appendChild(o);j+=1})});c.append(g)},e=h(this),b={count:0,fin:false,auto_slider:function(){window.clearTimeout(t);t=setTimeout(b.slide_left,
a.auto_scroll)},reset:function(){c.animate({left:0},a.slide_speed);c.find(".on").removeClass("on");c.find("ul:first-child").addClass("on")},slide_left:function(){b.last_ul=e.find(".on").is(":last-child")?true:false;if(b.fin)if(b.last_ul)a.reset&&b.reset();else c.animate({left:"-="+b.width,width:"+="+b.width},a.slide_speed,function(){e.find(".on").removeClass("on").next().addClass("on")});else c.is(":animated")||(b.last_ul?c.animate({left:"-="+b.width,width:"+="+b.width},a.slide_speed,function(){e.find(".on").removeClass("on");
s()}):c.animate({left:"-="+b.width,width:"+="+b.width},a.slide_speed,function(){e.find(".on").removeClass("on").next().addClass("on")}));a.auto_scroll&&!isNaN(a.auto_scroll)&&b.auto_slider()},slide_right:function(){if(!c.is(":animated")&&parseInt(c.css("left"),10)<0){e.find(".on").removeClass("on").prev().addClass("on");c.animate({left:"+="+b.width,width:"+="+b.width})}a.auto_scroll&&!isNaN(a.auto_scroll)&&b.auto_slider()},width:e.width()};for(option in p)if(p.hasOwnProperty(option))a[option]=p[option];
if(a.auto_scroll&&!isNaN(a.auto_scroll))var t=setTimeout(b.slide_left,a.auto_scroll);if(!e.children().length){h([m("button","arrow_left",0,0,a.left_arrow),m("button","arrow_right",0,0,a.right_arrow),m("div",0,0,"slideshow-inner")]).appendTo(e);var c=e.find(".slideshow-inner");s()}a.key_nav&&h(document).keyup(function(f){f.which===37&&b.slide_right();f.which===39&&b.slide_left()});e.delegate("button","click",function(){this.id==="arrow_left"&&b.slide_right();this.id==="arrow_right"&&b.slide_left()});
return this}})(jQuery);
